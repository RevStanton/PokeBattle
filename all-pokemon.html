<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>All PokÃ©mon Â· PokÃ©Battle Mini</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>PokÃ©Battle Mini</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="pokemon-info.html">PokÃ©dex</a>
      <a href="all-pokemon.html" class="active">All PokÃ©mon</a>
    </nav>
  </header>

  <main class="main-content info-page all-pokemon-page">
    <div class="search-panel">
      <input id="pokemon-search-all" placeholder="Filter PokÃ©monâ€¦"/>
    </div>

    <div id="all-pokemon-container" class="pokemon-grid"></div>

    <section id="pokemon-details"></section>
  </main>

  <script type="module">
  import { fetchAllPokemonList, fetchFullPokemon } from './services/allPokemonService.js';
  import { renderPokemonList }                     from './ui/allPokemonRenderer.js';
  import { renderFullPokemon }                     from './ui/fullPokemonRenderer.js';

  async function init() {
    console.log('ğŸ“– Initializing All PokÃ©mon page');

    // 1) fetch full list
    let list;
    try {
      list = await fetchAllPokemonList();
      console.log(`âœ… Fetched PokÃ©mon list (${list.length} entries)`);
    } catch (err) {
      console.error('âŒ Failed to fetch all PokÃ©mon:', err);
      return;
    }

    // 2) initial render
    try {
      renderPokemonList(list);
      console.log('âœ… Initial render completed');
    } catch (err) {
      console.error('âŒ renderPokemonList error:', err);
    }

    // 3) filtering
    const searchInput = document.getElementById('pokemon-search-all');
    console.log('ğŸ” search input element:', searchInput);
    searchInput.addEventListener('input', e => {
      const q = e.target.value.trim().toLowerCase();
      console.log('ğŸ“ Filter query:', q);
      const filtered = list.filter(p => p.name.includes(q));
      console.log(`ğŸ”„ Rendering ${filtered.length} filtered entries`);
      renderPokemonList(filtered);
    });

    // 4) click for details
    const grid = document.getElementById('all-pokemon-container');
    console.log('ğŸ® grid element:', grid);
    grid.addEventListener('click', async e => {
      const card = e.target.closest('.pkmn-card');
      console.log('ğŸ”˜ Card clicked:', card);
      if (!card) return;
      const name = card.dataset.name;
      console.log('ğŸ¾ Fetching full data for:', name);
      try {
        const data = await fetchFullPokemon(name);
        console.log('ğŸ“¦ Full data received for', name, data);
        renderFullPokemon(data);
        window.scrollTo({ top: 0, behavior: 'smooth' });
      } catch (err) {
        console.error(`âŒ Error fetching ${name}:`, err);
      }
    });
  }

  document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>