<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Dexteria — Pokédex</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <header>
    <h1>Dexteria</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="battle.html">Battle</a>
      <a href="pokedex.html" class="active">Pokédex</a>
    </nav>
  </header>

  <main class="main-content info-page all-pokemon-page">
    <!-- 1) Filter box -->
    <div class="search-panel">
      <input
        id="pokemon-search-all"
        type="text"
        placeholder="Filter Pokémon…"
        autocomplete="off"
      />
    </div>

    <!-- 2) Grid of all Pokémon -->
    <div id="all-pokemon-container" class="pokemon-grid"></div>
  </main>

  <!-- 3) Modal for full details (note id="pokemon-details"!) -->
  <div id="pokemon-modal" class="modal hidden">
    <div class="modal-content">
      <button id="modal-close" class="modal-close">✕</button>
      <!-- renderPokemonInfo still writes into #pokemon-details -->
      <div id="pokemon-details"></div>
    </div>
  </div>

  <script type="module">
    import {
      fetchAllPokemonList,
      fetchFullPokemon
    } from './services/allPokemonService.js';

    import {
      renderPokemonList
    } from './ui/allPokemonRenderer.js';

    import {
      renderFullPokemon
      // which internally calls renderPokemonInfo(...)
    } from './ui/fullPokemonRenderer.js';

    async function init() {
      // 1) fetch & render the full list
      const allList = await fetchAllPokemonList();
      renderPokemonList(allList);

      // 2) live‑filter
      document
        .getElementById('pokemon-search-all')
        .addEventListener('input', e => {
          const q = e.target.value.trim().toLowerCase();
          renderPokemonList(
            allList.filter(p => p.name.includes(q))
          );
        });

      // 3) click to open modal & render details into #pokemon-details
      const grid = document.getElementById('all-pokemon-container');
      const modal = document.getElementById('pokemon-modal');
      const details = document.getElementById('pokemon-details');
      const closeBtn = document.getElementById('modal-close');

      grid.addEventListener('click', async e => {
        const card = e.target.closest('.pkmn-card');
        if (!card) return;
        const name = card.dataset.name;

        // show modal & lock scroll
        details.innerHTML = '<p>Loading…</p>';
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';

        // fetch & render into #pokemon-details
        try {
          const full = await fetchFullPokemon(name);
          renderFullPokemon(full);  // uses #pokemon-details internally
        } catch (err) {
          console.error('Error loading', name, err);
          details.innerHTML = '<p>Error loading details.</p>';
        }
      });

      // 4) close handlers
      closeBtn.onclick = () => {
        modal.classList.add('hidden');
        document.body.style.overflow = '';
      };
      modal.onclick = evt => {
        if (evt.target === modal) {
          modal.classList.add('hidden');
          document.body.style.overflow = '';
        }
      };
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
